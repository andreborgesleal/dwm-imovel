@model Nullable<System.Decimal>
@{

    @*  string label,
    string id,
    string text,
    string lovModal,
    string crudModal,
    string controller,
    string descricao,
    string filedId,
    System.Web.Mvc.SelectListItem values = null,
    bool disableButtons = false)*@
    
    App_Dominio.Repositories.TypeaheadRepository t = (App_Dominio.Repositories.TypeaheadRepository)ViewData["typeahead"];

    string _value = "";
    string _text = "";
    if (t.values != null)
    {
        if (t.values.Value != null)
        {
            _value = t.values.Value;
        }
        if (t.values.Text != null)
        {
            _text = t.values.Text;
        }
    }
    string temp = t.text + "1";
    if (t.readOnly == null)
    {
        t.readOnly = true;
    }
}
<div id="div-lov"></div>
<input type="hidden" id="@t.id" name="@t.id" value="@_value" />
<input type="hidden" id="@temp" name="@temp" value="@t.values.Text" />
@*<div id="typeahead-div-@t.id"></div>
    onblur="$('#@t.nextField').focus();"
    onfocus="$('#@t.nextField').focus();"
*@
<div class="form-group">
    <label class="control-label" for="@t.label">@t.label</label>
    <div class="col-md-12 col-xs-10 col-sm-8 input-group">
        @if (t.crudModal == null && t.readOnly)
        {
            @*<input type="text" id="@t.text" name="@t.text" alue="@_text" class="form-control input-sm" onblur="validateTypeahead('@t.text', '@temp', '@t.id');" />*@
            <input autocomplete="on" id="@t.text" name="@t.text" value="@_text" placeholder="Buscar" readonly="@t.readOnly" class="form-control input-sm" type="search" />
        }
        else
        {
            <div class="typeahead-container">
                <div class="input-group">
                    <span class="typeahead-query">
                        <input autocomplete="on" type="search" id="@t.text" placeholder="Buscar" name="@t.text" value="@_text" class="form-control" readonly="@t.readOnly" >
                    </span>
                </div>
            </div>
        }
        <div class="input-group-btn">
            @if (!t.disableButtons)
            {
                if (t.javaScriptFunction == null)
                {
                    <button class="btn btn-sm" type="button" onclick="showLookup('@t.lovModal');"><i class="glyphicon glyphicon-search"></i></button>
                }
                else
                {
                    <button class="btn btn-sm" type="button" onclick="@t.javaScriptFunction"><i class="glyphicon glyphicon-search"></i></button>
                }
                if (t.crudModal != null)
                {
                    <button id="btnIns" class="btn btn-sm" type="button" onclick="InsertModal('../' + '@t.controller' + '/' + '@t.crudModal',
                            '@t.descricao' ,
                            '@t.id' ,
                            '@temp' ,
                            '@t.text' ,
                            '@t.nextField' );">
                        <i class="glyphicon glyphicon-plus"></i>
                    </button>
                }

                if (t.MiniCrudAdd != null)
                {
                    string div_miniCrud = "div-mini-crud" + t.id;
                    <button class="btn btn-sm" type="button" onclick="AddMiniCrud('@t.id', '@t.text', '@t.controller', '@t.MiniCrudAdd', '@div_miniCrud');"><i class="glyphicon glyphicon-th-list"></i></button>
                    <button class="btn btn-sm" type="button" onclick="CleanMiniCrud('@t.id', '@t.text', '@t.controller', '@t.MiniCrudClearAll', '@div_miniCrud');"><i class="glyphicon glyphicon-remove"></i></button>
                    <div id="@div_miniCrud">
                        <div class="row" style="font-weight: bold; font-family: Verdana; font-size: 11px; padding-top: 0px; border-bottom: 1px solid #808080;">
                            <div class="col-md-4" style="padding: 2px">
                                Código
                            </div>
                            <div class="col-md-7" style="padding: 2px">
                                Descrição
                            </div>
                            <div class="col-md-1" style="padding: 2px">
                                &nbsp;
                            </div>
                        </div>
                        <div class="row" style="height: 60px; overflow-y: auto">
                            <div class="col-md-12">
                                @if (t.MiniCrud != null && t.MiniCrud.Count() > 0)
                                {
                                    foreach (System.Web.Mvc.SelectListItem item in t.MiniCrud)
                                    {
                                        <div class="row" style="color: #808080; font-size: 11px; font-family: Verdana">
                                            <div class="col-md-4" style="padding: 2px; margin-bottom: -16px">
                                                @item.Value
                                            </div>
                                            <div class="col-md-7" style="padding: 2px; margin-bottom: -16px">
                                                @item.Text
                                            </div>
                                            <div class="col-md-1" style="padding: 2px; margin-bottom: -16px">
                                                <a href="#" onclick="DelMiniCrud('@item.Value', '@item.Text', '@t.controller', '@t.MiniCrudDel', '@div_miniCrud')"><i class="glyphicon glyphicon-trash"></i></a>
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    <button class="btn btn-sm" type="button" onclick="clean('@t.id','@t.text');"><i class="glyphicon glyphicon-remove"></i></button>
                }
            }
        </div>
    </div>
</div>



@*//  Formulário Modal para a mensagem*@
<div class="modal fade" id="myMessageModalTypeahead_@t.id" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="myModalLabel_@t.id">
                    Mensagem
                </h4>
            </div>
            <div class="modal-body">
                <p><label id="catarina"></label></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Fechar</button>
            </div>
        </div>

    </div>
</div>
<a id="linkModal" href="#myMessageModalTypeahead_@t.id" data-toggle="modal"></a>
@*// Fim-Formulário Modal*@

@*<script>
    var link = encodeURI('../@t.controller/getNames?noCahce=' + new Date());
    var data = { countries: [] };
    var hist = { countries: [] };
    $.ajax({
        type: "POST",
        url: link,
        contentType: "application/json; charset=utf-8",
        global: false,
        async: false,
        dataType: "json",
        success: function (jsonObj) {
            for (i in jsonObj) {
                data.countries.push(jsonObj[i].descricao);
                hist.countries.push({ objId: jsonObj[i].historicoId, descricao: jsonObj[i].descricao })
            };
        }
    });

    $('#@t.text').typeahead({
        minLength: 1,
        order: "asc",
        group: true,
        groupMaxItem: 5,
        hint: true,
        filter: "Filtro",
        selector: {
            filter: "input-group-btn",
            filterButton: "btn btn-default",
            dropdown: "dropdown-menu dropdown-menu-right",
            list: "dropdown-menu",
            hint: "form-control"
        },
        source: {
            '@t.ListName': {
                data: data.countries
            },

        },
        debug: true
    });

</script>*@



@*<script type="text/javascript">
        //var data = {
        //    countries: ["Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda",
        //        "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh",
        //        "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bermuda", "Bhutan", "Bolivia",
        //        "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burma",
        //        "Burundi", "Cambodia", "Cameroon", "Canada", "Cape Verde", "Central African Republic", "Chad",
        //        "Chile", "China", "Colombia", "Comoros", "Congo, Democratic Republic", "Congo, Republic of the",
        //        "Costa Rica", "Cote d'Ivoire", "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti",
        //        "Dominica", "Dominican Republic", "East Timor", "Ecuador", "Egypt", "El Salvador",
        //        "Equatorial Guinea", "Eritrea", "Estonia", "Ethiopia", "Fiji", "Finland", "France", "Gabon",
        //        "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Greenland", "Grenada", "Guatemala", "Guinea",
        //        "Guinea-Bissau", "Guyana", "Haiti", "Honduras", "Hong Kong", "Hungary", "Iceland", "India",
        //        "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan",
        //        "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kuwait", "Kyrgyzstan", "Laos",
        //        "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg",
        //        "Macedonia", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands",
        //        "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Mongolia", "Morocco", "Monaco",
        //        "Mozambique", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger",
        //        "Nigeria", "Norway", "Oman", "Pakistan", "Panama", "Papua New Guinea", "Paraguay", "Peru",
        //        "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Samoa", "San Marino",
        //        "Sao Tome", "Saudi Arabia", "Senegal", "Serbia and Montenegro", "Seychelles", "Sierra Leone",
        //        "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "Spain",
        //        "Sri Lanka", "Sudan", "Suriname", "Swaziland", "Sweden", "Switzerland", "Syria", "Taiwan",
        //        "Tajikistan", "Tanzania", "Thailand", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey",
        //        "Turkmenistan", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States",
        //        "Uruguay", "Uzbekistan", "Vanuatu", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"],
        //    capitals: ["Abu Dhabi", "Abuja", "Accra", "Adamstown", "Addis Ababa", "Algiers", "Alofi", "Amman", "Amsterdam",
        //        "Andorra la Vella", "Ankara", "Antananarivo", "Apia", "Ashgabat", "Asmara", "Astana", "Asunción", "Athens",
        //        "Avarua", "Baghdad", "Baku", "Bamako", "Bandar Seri Begawan", "Bangkok", "Bangui", "Banjul", "Basseterre",
        //        "Beijing", "Beirut", "Belgrade", "Belmopan", "Berlin", "Bern", "Bishkek", "Bissau", "Bogotá", "Brasília",
        //        "Bratislava", "Brazzaville", "Bridgetown", "Brussels", "Bucharest", "Budapest", "Buenos Aires", "Bujumbura",
        //        "Cairo", "Canberra", "Caracas", "Castries", "Cayenne", "Charlotte Amalie", "Chisinau", "Cockburn Town",
        //        "Conakry", "Copenhagen", "Dakar", "Damascus", "Dhaka", "Dili", "Djibouti", "Dodoma", "Doha", "Douglas",
        //        "Dublin", "Dushanbe", "Edinburgh of the Seven Seas", "El Aaiún", "Episkopi Cantonment", "Flying Fish Cove",
        //        "Freetown", "Funafuti", "Gaborone", "George Town", "Georgetown", "Georgetown", "Gibraltar", "King Edward Point",
        //        "Guatemala City", "Gustavia", "Hagåtña", "Hamilton", "Hanga Roa", "Hanoi", "Harare", "Hargeisa", "Havana",
        //        "Helsinki", "Honiara", "Islamabad", "Jakarta", "Jamestown", "Jerusalem", "Juba", "Kabul", "Kampala",
        //        "Kathmandu", "Khartoum", "Kiev", "Kigali", "Kingston", "Kingston", "Kingstown", "Kinshasa", "Kuala Lumpur",
        //        "Kuwait City", "Libreville", "Lilongwe", "Lima", "Lisbon", "Ljubljana", "Lomé", "London", "Luanda", "Lusaka",
        //        "Luxembourg", "Madrid", "Majuro", "Malabo", "Malé", "Managua", "Manama", "Manila", "Maputo", "Marigot",
        //        "Maseru", "Mata-Utu", "Mbabane Lobamba", "Melekeok Ngerulmud", "Mexico City", "Minsk", "Mogadishu", "Monaco",
        //        "Monrovia", "Montevideo", "Moroni", "Moscow", "Muscat", "Nairobi", "Nassau", "Naypyidaw", "N'Djamena",
        //        "New Delhi", "Niamey", "Nicosia", "Nicosia", "Nouakchott", "Nouméa", "Nukuʻalofa", "Nuuk", "Oranjestad",
        //        "Oslo", "Ottawa", "Ouagadougou", "Pago Pago", "Palikir", "Panama City", "Papeete", "Paramaribo", "Paris",
        //        "Philipsburg", "Phnom Penh", "Plymouth Brades Estate", "Podgorica Cetinje", "Port Louis", "Port Moresby",
        //        "Port Vila", "Port-au-Prince", "Port of Spain", "Porto-Novo Cotonou", "Prague", "Praia", "Cape Town",
        //        "Pristina", "Pyongyang", "Quito", "Rabat", "Reykjavík", "Riga", "Riyadh", "Road Town", "Rome", "Roseau",
        //        "Saipan", "San José", "San Juan", "San Marino", "San Salvador", "Sana'a", "Santiago", "Santo Domingo",
        //        "São Tomé", "Sarajevo", "Seoul", "Singapore", "Skopje", "Sofia", "Sri Jayawardenepura Kotte", "St. George's",
        //        "St. Helier", "St. John's", "St. Peter Port", "St. Pierre", "Stanley", "Stepanakert", "Stockholm", "Sucre",
        //        "Sukhumi", "Suva", "Taipei", "Tallinn", "Tarawa Atoll", "Tashkent", "Tbilisi", "Tegucigalpa", "Tehran",
        //        "Thimphu", "Tirana", "Tiraspol", "Tokyo", "Tórshavn", "Tripoli", "Tskhinvali", "Tunis", "Ulan Bator", "Vaduz",
        //        "Valletta", "The Valley", "Vatican City", "Victoria", "Vienna", "Vientiane", "Vilnius", "Warsaw",
        //        "Washington, D.C.", "Wellington", "West Island", "Willemstad", "Windhoek", "Yamoussoukro", "Yaoundé", "Yaren",
        //        "Yerevan", "Zagreb"]
        //};

        $(function () {
            $('#' + '@t.text').typeahead({
                source: function (term, process) {
                    var values = [];
                    map = {};
                    var url = '../' + '@t.controller' + '/GetNames';

                    return $.getJSON(url, { term: term }, function (data) {

                        // Loop through and push to the array
                        $.each(data, function (i, repository) {
                            var desc = 'repository.' + '@t.descricao';
                            map[eval(desc)] = repository;
                            values.push(eval(desc));
                        });
                        process(values);
                    });
                },
                updater: function (item) {
                    var code = 'map[item].';
                    if ('@t.fieldId' != null && '@t.fieldId' != "")
                        code = code + '@t.fieldId';
                    else
                        code = code + '@t.id';
                    var descri = 'map[item].' + '@t.descricao';
                    var selectedShortCode = eval(code);
                    $('#@t.id').val(selectedShortCode);
                    $('#@temp').val(eval(descri));
                    $('#@t.text').val(eval(descri));
                    $('#@t.nextField').focus();
                    return item;
                }
            });
        })
    </script>*@



